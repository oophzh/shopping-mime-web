"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","bootsnav","common"],function(t,e,i,r,o,a){function l(e){t("#small_image_list").length>0&&t("#small_image_list").html(t("#productSmallImage").tmpl(e)),t("#small_image_list li:first").attr("id","onlickImg"),t("#vertical img:first").attr("src",e[0].big_img),-1==C.indexOf(e[0].big_img)&&t("#imageLoading").removeClass("hide"),d()}function d(){var e=null;t(document).ready(function(){t("#imageMenu li img").bind("click",function(){"onlickImg"!=t(this).attr("id")&&(t("#midimg").attr("src",t(this).data().data),-1==C.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"),t("#imageMenu li").removeAttr("id"),t(this).parent().attr("id","onlickImg"))}).bind("mouseover",function(){"onlickImg"!=t(this).attr("id")&&(window.clearTimeout(e),t("#midimg").attr("src",t(this).data().data),-1==C.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"))}).bind("mouseout",function(){"onlickImg"!=t(this).attr("id")&&(t("#midimg").attr("src",t(this).data().data),-1==C.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"),t(this).removeAttr("style"),e=window.setTimeout(function(){t("#midimg").attr("src",t("#onlickImg img").data().data),-1==C.indexOf(t("#onlickImg img").data().data)&&t("#imageLoading").removeClass("hide")},1e3))})})}function n(e){1==e.length?I.productColorId=e[0].color_id:(t("#color_data_wrap").removeClass("hide"),t("#color_list").html(t("#colorItem").tmpl(e)),t(t("#color_list li")[v]).find("span").css("display","block"),t(t("#color_list li")[v]).find("img").addClass("selected-image-border"),t("#color_desc").html(e[v].color_des),I.productColorId=e[v].color_id,t("#color_list li").bind("click",function(){if("none"==t(this).find("span").css("display")){t("#color_list li").find("span").css("display","none"),t("#color_list li").find("img").removeClass("selected-image-border"),t(this).find("span").css("display","block"),t(this).find("img").addClass("selected-image-border");var i=t(this).data().data;t("#color_desc").html(e[i].color_des),t("#name").html(e[i].pcName),t("#product_ext_name").html(e[i].pcNameExt),t("#current_price").html(e[i].current_price),t("#original_price").html(e[i].original_price),I.productColorId=e[i].color_id,l(e[i].img_groups)}}))}function c(e){var i="";t("#dyn_attrs_list").html(t("#dynAttrsItem").tmpl(e));for(var r=0;r<e.length;r++){var o=e[r];t("#"+o.attr_name+"_content").html(o.domain_list[0]),o.selectedAttr=o.domain_list[0],"Size"==o.attr_name&&t("#size_guide").html(t.i18n.map.SizeGuide),i=0==r?o.attr_name+":"+o.selectedAttr:i+";"+o.attr_name+":"+o.selectedAttr}I.attrDes=i,t("#dyn_attrs_list select").each(function(){t(this).on("change",function(){var r=t(this).find("option:selected").text(),o=t(this).parent().data().data;i="";for(var a=0;a<e.length;a++){var l=e[a];a==o&&(l.selectedAttr=r),i=0==a?l.attr_name+":"+l.selectedAttr:i+";"+l.attr_name+":"+l.selectedAttr}I.attrDes=i})})}function u(){a.dao.productDetail({productId:h,currencyId:a.util.getLocalCurrency()},function(e){if(e.product_id){y=e;var i=e;I.productId=y.product_id;for(var r=a.util.getCurrencySymbol(a.util.getLocalCurrency()),o=0;o<i.color_data.length;o++){var d=i.color_data[o];d.original_price=a.util.formatProductPrice(d.original_price,r),d.current_price=a.util.formatProductPrice(d.current_price,r),d.img_display=a.util.picUrl+d.img_display,d.color_img=a.util.picUrl+d.color_img,d.width=200,d.height=200;for(var u=0;u<d.img_groups.length;u++){var g=d.img_groups[u];g.small_img=a.util.picUrl+g.small_img,g.big_img=a.util.picUrl+g.big_img}}i.product_des?t(".description").html(i.product_des):t(".description").parent().parent().hide(),document.title=i.product_name;for(var o=0;o<i.color_data.length;o++)if(f==i.color_data[o].color_id){v=o;break}t("#name").html(i.color_data[v].pcName),t("#product_ext_name").html(i.color_data[v].pcNameExt),t("#current_price").html(i.color_data[v].current_price),t("#original_price").html(i.color_data[v].original_price),f||(f=i.color_data[v].color_id),n(i.color_data),c(i.color_data[v].dyn_attrs),l(i.color_data[v].img_groups),p(i.product_type),a.util.menu=[],a.util.getClassifyNames(i.product_type,function(){s()}),m()}})}function s(){if(a.util.menu&&a.util.menu.length>0){var e=a.util.getAdvSource().u;e||(e=a.util.getQueryString("u"));var i="";e&&(i="?u="+e);var r=a.util.menu.reverse();r.push({menu_name:document.title});for(var o="<li><a id='breadcrumb_home' href='/'>"+t.i18n.map.Home+"</a></li>",l=0;l<r.length;l++)if(l==r.length-1)o=o+"<li class='active'>"+r[l].menu_name+"</li>",t("#product_classify_name").html(r[l].menu_name);else{var d=r[l].menu_name+"-l-"+a.util.encodeMenuType(r[l].menu_type)+"-"+a.util.encodeMenuType(a.util.getUvid())+".html"+i;o=o+"<li><a href='"+d+"'>"+r[l].menu_name+"</a></li>"}t(".breadcrumb").html(o)}}function m(){var t=sessionStorage.currentBrowseList;t=t?JSON.parse(t):[];for(var e=0;e<t.length;e++){var i=t[e];if(i.productId===h&&i.productColorId===f){t.splice(e,1);break}}var r={productId:h,productColorId:f};t.push(r),t.length>10&&(t=t.splice(1,t.length-1)),sessionStorage.setItem("currentBrowseList",JSON.stringify(t))}function p(e){a.dao.productsRel({menuType:e,productId:h,productColorId:I.productColorId},function(e){var i=a.util.getAdvSource().u;i||(i=a.util.getQueryString("u"));var r="";i&&(r="?u="+i);for(var o=a.util.encodeMenuType(a.util.getUvid()),l=0;l<e.length;l++){var d=e[l];d.imgDisplay=a.util.picUrl+d.imgDisplay;var n=a.util.formatProductName(d.prdName)+"-d-"+a.util.encodeMenuType(d.productId)+"-"+a.util.encodeMenuType(d.productColorId)+"-"+o+".html"+r;d.detailUrl=n}t("#peripheral_products_list").html(t("#peripheralProductListTempl").tmpl(e))})}console.log("detail.js");var g=window.location.href,_=a.util.getDetailParams(g),h=a.util.decodeMenuType(_[_.length-3]),f=a.util.decodeMenuType(_[_.length-2]),v=0,y={},I={productId:"",productColorId:"",productNum:"",attrDes:""},C=[];a.setCurrencyCodeCallback(function(){u()}),a.setLanguageCallback(function(){t("#breadcrumb_home").text(t.i18n.map.Home)}),a.initLoginStatus(),function(){t("#addCartBtn").click(function(){if(console.log("addCartBtn"),0==t("#dyn_attrs_list").children().length){if(""==I.productId||""==I.productColorId||""==I.productNum)return}else if(""==I.productId||""==I.productColorId||""==I.productNum||""==I.attrDes)return;if(a.util.checkIsLogin()){I.userId=a.util.getUserId();var e=[];e.push(I),a.dao.merge2cart({inputParams:JSON.stringify(e)},function(){window.location.href="../../../shopping_cart.html"},function(t){alert(t.msg)})}else{var e=localStorage.productList;e=e?JSON.parse(e):[];for(var i=!1,r=0,o=0;o<e.length;o++){var l=e[o];I.productId==l.productId&&I.productColorId==l.productColorId&&I.attrDes==l.attrDes&&(i=!0,l.productNum=l.productNum+I.productNum),r+=l.number}i||(e.push(I),r+=I.productNum),localStorage.productList=JSON.stringify(e),t("#cart_product_number").html(r),t("#cart_product_number").show(),window.location.href="../../../shopping_cart.html"}}),t("#addWishBtn").click(function(){a.util.checkIsLogin()||(window.location.href="../../../login.html")}),t("#midimg").load(function(e){console.log("big image loading"),t("#imageLoading").addClass("hide"),C.push(e.currentTarget.currentSrc)})}(),function(){t("#qty_list option[value='1']").prop("selected","selected");var e=t("#qty_list").find("option:selected").val();I.productNum=Number(e),t("#qty_list").on("change",function(){var e=t(this).find("option:selected").text();I.productNum=Number(e)})}()});