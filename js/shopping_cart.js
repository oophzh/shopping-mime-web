"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","bootsnav","common","bootstrapPaginator"],function(t,e,i,r,a,o,s){function n(){var e=t.i18n.map.FreeShippingTitle;e&&(e=e[0].replace("$price",sessionStorage.freeShippingAmount),t("#free_shipping_tab").html(e)),sessionStorage.priceRange&&"undefined"!==sessionStorage.priceRange?(t("#free_shipping_tab").addClass("active"),t("#recently_browser_tab").removeClass("active"),t("#shipping_list_wrap").removeClass("hide"),t("#recently_browse_wrap").addClass("hide")):t("#recently_browser_tab").addClass("active")}function l(){o.dao.getCoupon({userId:o.util.getUserId(),currencyId:o.util.getLocalCurrency()},function(e){if(e){var i=[e];t("#coupon_list_wrap").html(t("#couponListTempl").tmpl(i)),t("#coupon_list_wrap #code_text").html(t.i18n.map.Code),sessionStorage.setItem("couponCode",e.cpId),t("#coupon_code_input").val(e.cpId)}})}function c(){I=!1;var e="";1==sessionStorage.applyCouponCode&&(e=o.util.getCouponCode());var i={};if(o.util.checkIsLogin())i={currencyId:o.util.getLocalCurrency(),userId:o.util.getUserId(),cart:[],applyCpNo:e};else{if(!localStorage.productList||"[]"===localStorage.productList)return t("#cart_cost_title").hide(),t("#cart_cost_wrap").hide(),t("#cart_list").hide(),t("#empty_cart").show(),t("#product_total_number").html(0),t("#cart_product_number").html("0"),t("#cart_product_number").show(),t(".loading-mask").addClass("hide"),void(t(".main-wrap").hasClass("invisibility")&&t(".main-wrap").removeClass("invisibility"));i={currencyId:o.util.getLocalCurrency(),userId:"",cart:JSON.parse(localStorage.productList),applyCpNo:e}}o.dao.shoppingCartNoShipping({inputParams:JSON.stringify(i)},function(e){t(".loading-mask").addClass("hide"),e.cart&&e.cart.length>0?(t("#cart_list").show(),t("#cart_cost_title").show(),t("#cart_cost_wrap").show(),t("#empty_cart").hide(),d(e),A||(A=!0,t.getJSON("/resources/json/country.json",function(t){}))):(t("#cart_cost_title").hide(),t("#cart_cost_wrap").hide(),t("#cart_list").hide(),t("#empty_cart").show(),t("#product_total_number").html(0),t("#cart_product_number").html("0"),t("#cart_product_number").show()),t(".main-wrap").hasClass("invisibility")&&(t(".main-wrap").removeClass("invisibility"),t(".loading-mask").addClass("hide"))},function(){t(".loading-mask").addClass("hide")})}function d(e){console.log(e);var i=0,r=o.util.getCurrencySymbol(o.util.getLocalCurrency()),a=o.util.getAdvSource().u;a||(a=o.util.getQueryString("u"));var s="";a&&(s="?u="+a);for(var n=o.util.encodeMenuType(o.util.getUvid()),l=0;l<e.cart.length;l++){var c=e.cart[l];c.displayImg=o.util.picUrl+c.displayImg,c.cost=o.util.formatProductPrice(c.cost,r),c.unitPrice=o.util.formatProductPrice(c.unitPrice,r);var d=o.util.formatProductName(c.productName)+"-d-"+o.util.encodeMenuType(c.productId)+"-"+o.util.encodeMenuType(c.productColorId)+"-"+n+".html"+s;c.href=d,i+=Number(c.productNum)}t("#cart_list").html(t("#cartTempl").tmpl(e.cart)),t("#cart_list #color_title").html(t.i18n.map.ColorTitle),t("#cart_list #remove_label").html(t.i18n.map.Remove),t("#product_total_number").html(i),i>0?(t("#cart_product_number").html(i),t("#cart_product_number").show()):(t("#cart_product_number").html("0"),t("#cart_product_number").show());var u=3;sessionStorage.maxnum_allowed&&(u=Number(sessionStorage.maxnum_allowed)),i<=u&&t("#error_message").addClass("hide");for(var m=["1","2","3","4","5"],l=0;l<e.cart.length;l++){for(var g=document.getElementById("qty_list_"+l),_=0;_<m.length;_++)g.add(new Option(m[_],m[_])),e.cart[l].productNum==m[_]&&(g[_].selected=!0);t("#qty_list_"+l).on("change",function(){var i=t(this).find("option:selected").text();p(t(this).parent().parent().data().data,i,e)}),t("#"+l+" .remove-btn").each(function(){t(this).click(function(){console.log("del "+t(this).parent().parent().data().data+"item"),p(t(this).parent().parent().parent().parent().data().data,0,e)})})}for(var l=0;l<e.dis_info.length;l++){var h=e.dis_info[l];h.disAmount<0?h.disAmount="-"+o.util.formatProductPrice(-h.disAmount,r):h.disAmount=o.util.formatProductPrice(h.disAmount,r),8==h.policyId&&(I=!0)}if(t("#dis_info_list").html(t("#disInfoTempl").tmpl(e.dis_info)),I?(t("#apply_btn").text(t.i18n.map.Cancel),t("#apply_btn").css("background","#333")):(t("#apply_btn").text(t.i18n.map.Apply),t("#apply_btn").css("background","#ea5455")),e.reachFreeShipping&&1==e.reachFreeShipping)t("#free_tip").css("color","#008800"),t("#free_tip").html(e.freeShippingInfo);else{t("#free_tip").css("color","#333");var f=t.i18n.map.FreeShippingTip;if(f&&(f=f.replace("$price","<span style='color: #ea5455;'>"+e.freeShippingInfo+"</span>"),f=f+"<span id='free_tip_add_more' class='free-tip-add-more'>"+t.i18n.map.AddFreeShipping+"</span>"),t("#free_tip").html(f),t("#free_tip_add_more").click(function(){t("#free_shipping_tab").addClass("active"),t("#recently_browser_tab").removeClass("active"),t("#shipping_list_wrap").removeClass("hide"),t("#recently_browse_wrap").addClass("hide"),window.scrollTo(0,t("#free_shipping_tab").offset().top-150)}),sessionStorage.priceRange&&"undefined"!==sessionStorage.priceRange){var C=JSON.parse(sessionStorage.priceRange);C&&C.length>0&&t("#free_tip_add_more").css("display","inline-block")}else t("#free_tip_add_more").css("display","none")}t("#sub_total").html(o.util.formatProductPrice(e.amount,r)),t("#grand_total").html(o.util.formatProductPrice(e.realAmount,r)),e.cpPromptInfo&&t("#coupon_use_info").html(e.cpPromptInfo),S=e.realAmount,w=e.amountAllowed}function p(e,i,r){if(console.log("changeProductNumber"),o.util.checkIsLogin()){var a=r.cart[e];a.productNum=Number(i),a.userId=o.util.getUserId(),t(".loading-mask").removeClass("hide"),o.dao.shoppingCartMt({inputParams:JSON.stringify([a])},function(t){c()})}else if(localStorage.productList){t(".loading-mask").removeClass("hide");var s=JSON.parse(localStorage.productList);if(0==Number(i))s.splice(e,1);else{var a=s[e];a.productNum=Number(i)}localStorage.setItem("productList",JSON.stringify(s)),c()}}function u(){var e=[];sessionStorage.currentBrowseList&&(e=JSON.parse(sessionStorage.currentBrowseList));var i={currencyId:o.util.getLocalCurrency(),products:e};o.dao.productsViewed({inputParams:JSON.stringify(i)},function(e){if(e&&e.length>0){var i=o.util.getCurrencySymbol(o.util.getLocalCurrency()),r=o.util.getAdvSource().u;r||(r=o.util.getQueryString("u"));var a="";r&&(a="?u="+r);for(var s=o.util.encodeMenuType(o.util.getUvid()),n=0;n<e.length;n++){var l=e[n];l.orgPrice=o.util.formatProductPrice(l.orgPrice,i),l.curPrice=o.util.formatProductPrice(l.curPrice,i),l.imgDisplay=o.util.picUrl+l.imgDisplay,l.height=o.util.getCartImageHeight();var c=o.util.formatProductName(l.productName)+"-d-"+o.util.encodeMenuType(l.productId)+"-"+o.util.encodeMenuType(l.productColorId)+"-"+s+".html"+a;l.href=c}t("#product_viewed_list_wrap").html(t("#productViewedListTempl").tmpl(e)),t("#recently_browse_wrap").find(".free-shpping-empty-data").addClass("hide")}else t("#recently_browse_wrap").find(".free-shpping-empty-data").removeClass("hide")})}function m(){if(sessionStorage.priceRange&&"undefined"!==sessionStorage.priceRange){var e=JSON.parse(sessionStorage.priceRange);e&&e.length>0&&(t("#price_zone_list").html(t("#priceZoneTempl").tmpl(e)),t(t("#price_zone_list").find("li")[L]).addClass("current"),t("#price_zone_list li").each(function(){t(this).click(function(){L=t(this)[0].id,t("#price_zone_list").find("li").removeClass("current"),t(this).addClass("current"),x.curPage=1,g(e[L].from,e[L].to)})}),t("#price_zone_list").find("li").removeClass("current"),t(t("#price_zone_list").find("li")[L]).addClass("current"),g(e[L].from,e[L].to))}else t("#free_shipping_tab").addClass("hide"),t("#shipping_list_wrap").addClass("hide"),t("#recently_browse_wrap").removeClass("hide")}function g(e,i){t("#shipping_list_wrap .shipping-list-loading-data").removeClass("hide"),o.dao.productsByPriceRange({currencyId:o.util.getLocalCurrency(),currentPage:x.curPage,from:e,to:i},function(e){e.page&&(x.amount=e.page.amount,x.pageSize=e.page.pageSize);var i=e.products;if(i&&i.length>0){for(var r=o.util.getCurrencySymbol(o.util.getLocalCurrency()),a=0;a<i.length;a++){var s=i[a];s.original_price=o.util.formatProductPrice(s.original_price,r),s.current_price=o.util.formatProductPrice(s.current_price,r),s.img_display=o.util.picUrl+s.img_display,s.height=o.util.getCartImageHeight()}t("#shipping_list").html(t("#shippingListTempl").tmpl(i)),t(".free-shipping-item").each(function(){t(this).click(function(){h(t(this)[0].id)})}),1==x.curPage&&_(),t("#shipping_list_wrap").find(".free-shpping-empty-data").addClass("hide"),t("#shipping_list_wrap").find("#page_wrap").removeClass("hide"),t("#shipping_list_wrap").find("#shipping_list").removeClass("hide"),t("#shipping_list_wrap .shipping-list-loading-data").addClass("hide")}else t("#shipping_list_wrap").find(".free-shpping-empty-data").removeClass("hide"),t("#shipping_list_wrap").find("#page_wrap").addClass("hide"),t("#shipping_list_wrap").find("#shipping_list").addClass("hide"),t("#shipping_list_wrap .shipping-list-loading-data").addClass("hide")},function(){t("#shipping_list_wrap").find(".free-shpping-empty-data").removeClass("hide"),t("#shipping_list_wrap").find("#page_wrap").addClass("hide"),t("#shipping_list_wrap").find("#shipping_list").addClass("hide"),t("#shipping_list_wrap .shipping-list-loading-data").addClass("hide")})}function _(){var e=0;e=x.amount%x.pageSize==0?x.amount/x.pageSize:x.amount/x.pageSize+1,t(function(){var i={bootstrapMajorVersion:1,currentPage:x.curPage,numberOfPages:5,totalPages:e,shouldShowPage:!0,onPageClicked:function(e,r,a,o){x.curPage=o;var s=JSON.parse(sessionStorage.priceRange);g(s[L].from,s[L].to),i.currentPage=o,t("#page").bootstrapPaginator(i)}};t("#page").bootstrapPaginator(i)})}function h(e){o.dao.productDetail({productId:e,currencyId:o.util.getLocalCurrency()},function(e){if(e.product_id){N.productId=e.product_id;for(var i=o.util.getCurrencySymbol(o.util.getLocalCurrency()),r=0;r<e.color_data.length;r++){var a=e.color_data[r];a.original_price=o.util.formatProductPrice(a.original_price,i),a.current_price=o.util.formatProductPrice(a.current_price,i),a.img_display=o.util.picUrl+a.img_display,a.color_img=o.util.picUrl+a.color_img,a.width=200,a.height=200;for(var s=0;s<a.img_groups.length;s++){var n=a.img_groups[s];n.small_img=o.util.picUrl+n.small_img,n.big_img=o.util.picUrl+n.big_img}}e.product_des?t(".description").html(e.product_des):t(".description").parent().parent().hide(),t("#name").html(e.color_data[P].pcName),t("#product_ext_name").html(e.color_data[P].pcNameExt),t("#current_price").html(e.color_data[P].current_price),t("#original_price").html(e.color_data[P].original_price),f(e.color_data),C(e.color_data[P].dyn_attrs),v(),y(e.color_data[P].img_groups),t("#product_detail_mask").removeClass("hide"),t("#product_detail_mask #close_btn").click(function(){t("#product_detail_mask").addClass("hide")})}})}function f(e){1==e.length?N.productColorId=e[0].color_id:(t("#color_data_wrap").removeClass("hide"),t("#color_list").html(t("#colorItem").tmpl(e)),t(t("#color_list li")[P]).find("span").css("display","block"),t(t("#color_list li")[P]).find("img").addClass("selected-image-border"),t("#color_desc").html(e[P].color_des),N.productColorId=e[P].color_id,t("#color_list li").bind("click",function(){if("none"==t(this).find("span").css("display")){t("#color_list li").find("span").css("display","none"),t("#color_list li").find("img").removeClass("selected-image-border"),t(this).find("span").css("display","block"),t(this).find("img").addClass("selected-image-border");var i=t(this).data().data;t("#color_desc").html(e[i].color_des),t("#name").html(e[i].pcName),t("#product_ext_name").html(e[i].pcNameExt),t("#current_price").html(e[i].current_price),t("#original_price").html(e[i].original_price),N.productColorId=e[i].color_id,y(e[i].img_groups)}}))}function C(e){var i="";t("#dyn_attrs_list").html(t("#dynAttrsItem").tmpl(e));for(var r=0;r<e.length;r++){var a=e[r];t("#"+a.attr_name+"_content").html(a.domain_list[0]),a.selectedAttr=a.domain_list[0],"Size"==a.attr_name&&t("#size_guide").html(t.i18n.map.SizeGuide),i=0==r?a.attr_name+":"+a.selectedAttr:i+";"+a.attr_name+":"+a.selectedAttr}N.attrDes=i,t("#dyn_attrs_list select").each(function(){t(this).on("change",function(){var r=t(this).find("option:selected").text(),a=t(this).parent().data().data;i="";for(var o=0;o<e.length;o++){var s=e[o];o==a&&(s.selectedAttr=r),i=0==o?s.attr_name+":"+s.selectedAttr:i+";"+s.attr_name+":"+s.selectedAttr}N.attrDes=i})})}function v(){t("#qty_list option[value='1']").prop("selected","selected");var e=t("#qty_list").find("option:selected").val();N.productNum=Number(e),t("#qty_list").on("change",function(){var e=t(this).find("option:selected").text();N.productNum=Number(e)})}function y(e){t("#small_image_list").length>0&&t("#small_image_list").html(t("#productSmallImage").tmpl(e)),t("#small_image_list li:first").attr("id","onlickImg"),t("#vertical img:first").attr("src",e[0].big_img),-1==k.indexOf(e[0].big_img)&&t("#imageLoading").removeClass("hide"),b()}function b(){var e=null;t(document).ready(function(){t("#imageMenu li img").bind("click",function(){"onlickImg"!=t(this).attr("id")&&(t("#midimg").attr("src",t(this).data().data),-1==k.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"),t("#imageMenu li").removeAttr("id"),t(this).parent().attr("id","onlickImg"))}).bind("mouseover",function(){"onlickImg"!=t(this).attr("id")&&(window.clearTimeout(e),t("#midimg").attr("src",t(this).data().data),-1==k.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"))}).bind("mouseout",function(){"onlickImg"!=t(this).attr("id")&&(t("#midimg").attr("src",t(this).data().data),-1==k.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"),t(this).removeAttr("style"),e=window.setTimeout(function(){t("#midimg").attr("src",t("#onlickImg img").data().data),-1==k.indexOf(t("#onlickImg img").data().data)&&t("#imageLoading").removeClass("hide")},1e3))})})}console.log("cart.js");var w="",S="",I=!1,P=0,N={productId:"",productColorId:"",productNum:"",attrDes:""},k=[],L=0,x={amount:0,curPage:1,pageSize:8},A=!1;!function(){t("#continue_shopping_btn").click(function(){window.location.href="/"}),t("#checkout_btn").click(function(){var e=Number(t("#product_total_number").text()),i=3;if(sessionStorage.maxnum_allowed&&(i=Number(sessionStorage.maxnum_allowed)),e>i)t("#error_message").html(t.i18n.map.maxErrorMsg1+" "+i+t.i18n.map.maxErrorMsg2),t("#error_message").removeClass("hide"),setTimeout(function(){alert(t.i18n.map.maxErrorMsg1+" "+i+t.i18n.map.maxErrorMsg2)},1);else if(S>w){var r=o.util.getCurrencySymbol(o.util.getLocalCurrency());t("#error_message").html(t.i18n.map.maxAmountErrorMsg1+" "+o.util.formatProductPrice(S,r)+t.i18n.map.maxAmountErrorMsg2+" "+o.util.formatProductPrice(w,r)+t.i18n.map.maxAmountErrorMsg3),t("#error_message").removeClass("hide"),setTimeout(function(){alert(t.i18n.map.maxAmountErrorMsg1+" "+o.util.formatProductPrice(S,r)+t.i18n.map.maxAmountErrorMsg2+" "+o.util.formatProductPrice(w,r)+t.i18n.map.maxAmountErrorMsg3)},1)}else t("#error_message").addClass("hide"),o.util.checkIsLogin()?window.location.href="../../../checkout_shipping.html":window.location.href="../../../login.html"}),t("#apply_btn").click(function(){I?(sessionStorage.setItem("applyCouponCode",0),t("#coupon_use_info").html(""),c()):t("#coupon_code_input").val()&&o.util.getCouponCode()&&(o.util.getCouponCode()===t("#coupon_code_input").val()?(sessionStorage.setItem("applyCouponCode",1),t(".loading-mask").removeClass("hide")):(sessionStorage.setItem("applyCouponCode",0),t("#coupon_use_info").html(t.i18n.map.ErrorCouponCode)),c())}),t("#free_shipping_tab").click(function(){t("#free_shipping_tab").addClass("active"),t("#recently_browser_tab").removeClass("active"),t("#shipping_list_wrap").removeClass("hide"),t("#recently_browse_wrap").addClass("hide")}),t("#recently_browser_tab").click(function(){t("#recently_browser_tab").addClass("active"),t("#free_shipping_tab").removeClass("active"),t("#shipping_list_wrap").addClass("hide"),t("#recently_browse_wrap").removeClass("hide")}),t("#midimg").load(function(e){console.log("big image loading"),t("#imageLoading").addClass("hide"),k.push(e.currentTarget.currentSrc)}),t("#addCartBtn").click(function(){if(console.log("addCartBtn"),0==t("#dyn_attrs_list").children().length){if(""==N.productId||""==N.productColorId||""==N.productNum)return}else if(""==N.productId||""==N.productColorId||""==N.productNum||""==N.attrDes)return;if(o.util.checkIsLogin()){N.userId=o.util.getUserId();var e=[];e.push(N),o.dao.merge2cart({inputParams:JSON.stringify(e)},function(){t("#product_detail_mask").addClass("hide"),c()},function(t){alert(t.msg)})}else{var e=localStorage.productList;e=e?JSON.parse(e):[];for(var i=!1,r=0,a=0;a<e.length;a++){var s=e[a];N.productId==s.productId&&N.productColorId==s.productColorId&&N.attrDes==s.attrDes&&(i=!0,s.productNum=s.productNum+N.productNum),r+=s.number}i||(e.push(N),r+=N.productNum),localStorage.productList=JSON.stringify(e),t("#cart_product_number").html(r),t("#cart_product_number").show(),t("#product_detail_mask").addClass("hide"),c()}})}(),o.setLanguageCallback(function(){n(),c()}),o.setCurrencyCodeCallback(function(){n(),c(),u(),m(),l()}),o.initLoginStatus(function(e){o.util.getLocalCurrency()&&(c(),u(),m()),e?(t("#coupon_hint_wrap").addClass("hide"),t("#coupon_hint_wrap").attr("href","javascript:void(0)"),l()):(t("#coupon_hint_wrap").removeClass("hide"),t("#coupon_hint_wrap").attr("href","login.html"))})});